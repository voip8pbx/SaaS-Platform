{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///D:/NEXT.js/SuperAdmin/src/app/api/config/customize/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\r\nimport fs from 'fs';\r\nimport path from 'path';\r\n\r\n// Define the path to the template's siteConfig\r\nconst targetPath = 'D:\\\\NEXT.js\\\\Travelpannerwebsite\\\\src\\\\config\\\\siteConfig.ts';\r\n\r\n/**\r\n * Helper to safely extract the JS object from string using Function\r\n * Note: This is risky if input is not trusted, but this is a local admin tool.\r\n * A safer way is robust parsing, but for this prototype, regex replacement is preferred.\r\n */\r\n\r\nexport async function POST(request: Request) {\r\n    try {\r\n        const body = await request.json();\r\n        const { feature, colors, primaryColor } = body;\r\n        // feature: 'flights' | 'packages' | 'global'\r\n        // colors: { header: string, background: string }\r\n\r\n        // Read existing file\r\n        if (!fs.existsSync(targetPath)) {\r\n            return NextResponse.json({ success: false, error: 'Target config file not found' }, { status: 404 });\r\n        }\r\n\r\n        let content = fs.readFileSync(targetPath, 'utf8');\r\n\r\n        // 1. Update Primary Color if present\r\n        if (primaryColor) {\r\n            content = content.replace(/primaryColor:\\s*[\"'].*?[\"']/, `primaryColor: \"${primaryColor}\"`);\r\n        }\r\n\r\n        // 2. Update Custom Colors intelligently\r\n        if (feature && colors) {\r\n            // We need to parse the existing customColors block to merging\r\n            // Let's try to extract the inner content of customColors\r\n            const match = content.match(/customColors:\\s*\\{([\\s\\S]*?)\\n\\s*\\}/);\r\n\r\n            if (match) {\r\n                const currentBlockContent = match[1];\r\n\r\n                // We will reconstruct the whole customColors object because standard JSON.parse won't work on JS file content easily\r\n                // Strategy: \r\n                // We know the structure we want:\r\n                // customColors: {\r\n                //    background: \"...\",\r\n                //    header: \"...\",\r\n                //    flights: { ... },\r\n                //    packages: { ... }\r\n                // }\r\n\r\n                // Regex finding current values\r\n                const findValue = (key: string, text: string) => {\r\n                    // key: \"val\" or key: { ... }\r\n                    // Simple regex for string values: key:\\s*\"([^\"]*)\"\r\n                    const regex = new RegExp(`${key}:\\\\s*\"([^\"]*)\"`);\r\n                    const m = text.match(regex);\r\n                    return m ? m[1] : \"\";\r\n                };\r\n\r\n                // Get globals\r\n                let globalBg = findValue('background', currentBlockContent);\r\n                let globalHeader = findValue('header', currentBlockContent);\r\n\r\n                // If we are updating globals\r\n                if (feature === 'global') {\r\n                    globalBg = colors.background || globalBg;\r\n                    globalHeader = colors.header || globalHeader;\r\n                }\r\n\r\n                // Function to get or create feature block\r\n                const getFeatureBlock = (featName: string, text: string) => {\r\n                    const regex = new RegExp(`${featName}:\\\\s*\\\\{([\\\\s\\\\S]*?)\\\\}`);\r\n                    const m = text.match(regex);\r\n                    let featBg = \"\";\r\n                    let featHeader = \"\";\r\n                    if (m) {\r\n                        featBg = findValue('background', m[1]);\r\n                        featHeader = findValue('header', m[1]);\r\n                    }\r\n                    return { background: featBg, header: featHeader };\r\n                };\r\n\r\n                const flights = getFeatureBlock('flights', currentBlockContent);\r\n                const packages = getFeatureBlock('packages', currentBlockContent);\r\n\r\n                // Update specific feature\r\n                if (feature === 'flights') {\r\n                    flights.background = colors.background;\r\n                    flights.header = colors.header;\r\n                } else if (feature === 'packages') {\r\n                    packages.background = colors.background;\r\n                    packages.header = colors.header;\r\n                }\r\n\r\n                // Construct new block\r\n                const newCustomColors = `customColors: {\r\n        background: \"${globalBg}\",\r\n        header: \"${globalHeader}\",\r\n        flights: { header: \"${flights.header}\", background: \"${flights.background}\" },\r\n        packages: { header: \"${packages.header}\", background: \"${packages.background}\" }\r\n    }`;\r\n                // Replace in content\r\n                // Safer regex: Match from customColors start until the comma before 'theme:' property\r\n                // This assumes standard formatting where customColors is followed by theme\r\n                content = content.replace(/customColors:\\s*\\{[\\s\\S]*?\\},(?=\\s*theme:)/, `${newCustomColors},`);\r\n\r\n            } else {\r\n                // If match fails, fallback to simple replacement (destructive but safe for now?)\r\n                // Or maybe the block is single line?\r\n                // Let's assume standard formatting from previous edits.\r\n            }\r\n        }\r\n\r\n        fs.writeFileSync(targetPath, content);\r\n\r\n        return NextResponse.json({ success: true, message: 'Configuration updated' });\r\n    } catch (error) {\r\n        console.error('Error updating config:', error);\r\n        return NextResponse.json({ success: false, error: 'Failed to update configuration' }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}